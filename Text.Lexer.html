<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Text.Lexer</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--without-K</a> <a id="25" class="Pragma">--safe</a> <a id="32" class="Symbol">#-}</a>

<a id="37" class="Keyword">open</a> <a id="42" class="Keyword">import</a> <a id="49" href="Level.html" class="Module">Level</a>
<a id="55" class="Keyword">open</a> <a id="60" class="Keyword">import</a> <a id="67" href="Data.Unit.html" class="Module">Data.Unit</a>
<a id="77" class="Keyword">open</a> <a id="82" class="Keyword">import</a> <a id="89" href="Data.Bool.html" class="Module">Data.Bool</a>
<a id="99" class="Keyword">open</a> <a id="104" class="Keyword">import</a> <a id="111" href="Data.Char.html" class="Module">Data.Char</a>          <a id="130" class="Symbol">as</a> <a id="133" class="Module">Char</a>
<a id="138" class="Keyword">open</a> <a id="143" class="Keyword">import</a> <a id="150" href="Data.List.html" class="Module">Data.List</a>          <a id="169" class="Symbol">as</a> <a id="172" class="Module">List</a> <a id="177" class="Keyword">using</a> <a id="183" class="Symbol">(</a><a id="184" href="Agda.Builtin.List.html#121" class="Datatype">List</a><a id="188" class="Symbol">;</a> <a id="190" href="Data.List.Base.html#9863" class="InductiveConstructor">[]</a><a id="192" class="Symbol">;</a> <a id="194" href="Agda.Builtin.List.html#173" class="InductiveConstructor Operator">_∷_</a><a id="197" class="Symbol">)</a>
<a id="199" class="Keyword">open</a> <a id="204" class="Keyword">import</a> <a id="211" href="Data.List.NonEmpty.html" class="Module">Data.List.NonEmpty</a> <a id="230" class="Symbol">as</a> <a id="233" class="Module">List⁺</a> <a id="239" class="Keyword">using</a> <a id="245" class="Symbol">(</a><a id="246" href="Data.List.NonEmpty.html#1171" class="Record">List⁺</a><a id="251" class="Symbol">;</a> <a id="253" href="Data.List.NonEmpty.html#1221" class="InductiveConstructor Operator">_∷_</a><a id="256" class="Symbol">)</a>
<a id="258" class="Keyword">open</a> <a id="263" class="Keyword">import</a> <a id="270" href="Data.Maybe.html" class="Module">Data.Maybe</a>         <a id="289" class="Symbol">as</a> <a id="292" class="Module">Maybe</a>
<a id="298" class="Keyword">open</a> <a id="303" class="Keyword">import</a> <a id="310" href="Data.Product.html" class="Module">Data.Product</a>       <a id="329" class="Symbol">as</a> <a id="332" class="Module">Prod</a>
<a id="337" class="Keyword">open</a> <a id="342" class="Keyword">import</a> <a id="349" href="Data.String.Base.html" class="Module">Data.String.Base</a>   <a id="368" class="Symbol">as</a> <a id="371" class="Module">String</a> <a id="378" class="Keyword">using</a> <a id="384" class="Symbol">(</a><a id="385" href="Agda.Builtin.String.html#206" class="Postulate">String</a><a id="391" class="Symbol">)</a>
<a id="393" class="Keyword">open</a> <a id="398" class="Keyword">import</a> <a id="405" href="Data.These.html" class="Module">Data.These</a>         <a id="424" class="Symbol">as</a> <a id="427" class="Module">These</a>

<a id="434" class="Keyword">open</a> <a id="439" class="Keyword">import</a> <a id="446" href="Function.html" class="Module">Function</a>

<a id="456" class="Keyword">open</a> <a id="461" class="Keyword">import</a> <a id="468" href="Text.Parser.Position.html" class="Module">Text.Parser.Position</a> <a id="489" class="Symbol">as</a> <a id="492" class="Module">Pos</a> <a id="496" class="Keyword">using</a> <a id="502" class="Symbol">(</a><a id="503" href="Text.Parser.Position.html#310" class="Record">Position</a><a id="511" class="Symbol">)</a>

<a id="514" class="Keyword">module</a> <a id="521" href="Text.Lexer.html" class="Module">Text.Lexer</a>
  <a id="534" class="Comment">-- Our lexer is parametrised over the type of tokens</a>
  <a id="589" class="Symbol">{</a><a id="590" href="Text.Lexer.html#590" class="Bound">t</a><a id="591" class="Symbol">}</a> <a id="593" class="Symbol">{</a><a id="594" href="Text.Lexer.html#594" class="Bound">Tok</a> <a id="598" class="Symbol">:</a> <a id="600" class="PrimitiveType">Set</a> <a id="604" href="Text.Lexer.html#590" class="Bound">t</a><a id="605" class="Symbol">}</a>
  <a id="609" class="Comment">-- We start with an association list between</a>
  <a id="656" class="Comment">-- * keywords (as Strings)</a>
  <a id="685" class="Comment">-- * keywords (as token values)</a>
  <a id="719" class="Symbol">(</a><a id="720" href="Text.Lexer.html#720" class="Bound">keywords</a> <a id="729" class="Symbol">:</a> <a id="731" href="Data.List.NonEmpty.html#1171" class="Record">List⁺</a> <a id="737" class="Symbol">(</a><a id="738" href="Agda.Builtin.String.html#206" class="Postulate">String</a> <a id="745" href="Data.Product.html#1389" class="Function Operator">×</a> <a id="747" href="Text.Lexer.html#594" class="Bound">Tok</a><a id="750" class="Symbol">))</a>
  <a id="755" class="Comment">-- Some characters are special: they are separators, breaking a string into</a>
  <a id="833" class="Comment">-- a list of tokens. Some are associated to a token value (e.g. parentheses)</a>
  <a id="912" class="Comment">-- others are not (e.g. space)</a>
  <a id="945" class="Symbol">(</a><a id="946" href="Text.Lexer.html#946" class="Bound">breaking</a> <a id="955" class="Symbol">:</a> <a id="957" href="Agda.Builtin.Char.html#200" class="Postulate">Char</a> <a id="962" class="Symbol">→</a> <a id="964" href="Data.Product.html#917" class="Function">∃</a> <a id="966" class="Symbol">λ</a> <a id="968" href="Text.Lexer.html#968" class="Bound">b</a> <a id="970" class="Symbol">→</a> <a id="972" href="Data.Bool.Base.html#835" class="Function Operator">if</a> <a id="975" href="Text.Lexer.html#968" class="Bound">b</a> <a id="977" href="Data.Bool.Base.html#835" class="Function Operator">then</a> <a id="982" href="Data.Maybe.Base.html#710" class="Datatype">Maybe</a> <a id="988" href="Text.Lexer.html#594" class="Bound">Tok</a> <a id="992" href="Data.Bool.Base.html#835" class="Function Operator">else</a> <a id="997" href="Level.html#394" class="Record">Lift</a> <a id="1002" class="Symbol">_</a> <a id="1004" href="Agda.Builtin.Unit.html#137" class="Record">⊤</a><a id="1005" class="Symbol">)</a>
  <a id="1009" class="Comment">-- Finally, strings which are not decoded as keywords are coerced using a</a>
  <a id="1085" class="Comment">-- function to token values.</a>
  <a id="1116" class="Symbol">(</a><a id="1117" href="Text.Lexer.html#1117" class="Bound">default</a>  <a id="1126" class="Symbol">:</a> <a id="1128" href="Agda.Builtin.String.html#206" class="Postulate">String</a> <a id="1135" class="Symbol">→</a> <a id="1137" href="Text.Lexer.html#594" class="Bound">Tok</a><a id="1140" class="Symbol">)</a>
  <a id="1144" class="Keyword">where</a>

  <a id="Result"></a><a id="1153" href="Text.Lexer.html#1153" class="Function">Result</a> <a id="1160" class="Symbol">:</a> <a id="1162" class="PrimitiveType">Set</a> <a id="1166" class="Symbol">_</a>
  <a id="1170" href="Text.Lexer.html#1153" class="Function">Result</a> <a id="1177" class="Symbol">=</a> <a id="1179" href="Agda.Builtin.List.html#121" class="Datatype">List</a> <a id="1184" class="Symbol">(</a><a id="1185" href="Text.Parser.Position.html#310" class="Record">Position</a> <a id="1194" href="Data.Product.html#1389" class="Function Operator">×</a> <a id="1196" href="Text.Lexer.html#594" class="Bound">Tok</a><a id="1199" class="Symbol">)</a>

  <a id="tokenize"></a><a id="1204" href="Text.Lexer.html#1204" class="Function">tokenize</a> <a id="1213" class="Symbol">:</a> <a id="1215" href="Agda.Builtin.String.html#206" class="Postulate">String</a> <a id="1222" class="Symbol">→</a> <a id="1224" href="Text.Lexer.html#1153" class="Function">Result</a>
  <a id="1233" href="Text.Lexer.html#1204" class="Function">tokenize</a> <a id="1242" class="Symbol">=</a> <a id="1244" href="Text.Lexer.html#1985" class="Function">start</a> <a id="1250" href="Text.Parser.Position.html#409" class="Function">Pos.start</a> <a id="1260" href="Function.html#994" class="Function Operator">∘′</a> <a id="1263" href="Agda.Builtin.String.html#262" class="Primitive">String.toList</a> <a id="1277" class="Keyword">where</a>

   <a id="1287" class="Keyword">mutual</a>

    <a id="1299" class="Comment">-- We build a trie from the association list so that we may easily compute</a>
    <a id="1378" class="Comment">-- the successive derivatives obtained by eating the characters one by one</a>
    <a id="1457" href="Text.Lexer.html#1457" class="Function">Keywords</a> <a id="1466" class="Symbol">:</a> <a id="1468" class="PrimitiveType">Set</a> <a id="1472" class="Symbol">_</a>
    <a id="1478" href="Text.Lexer.html#1457" class="Function">Keywords</a> <a id="1487" class="Symbol">=</a> <a id="1489" href="Agda.Builtin.List.html#121" class="Datatype">List</a> <a id="1494" class="Symbol">(</a><a id="1495" href="Agda.Builtin.List.html#121" class="Datatype">List</a> <a id="1500" href="Agda.Builtin.Char.html#200" class="Postulate">Char</a> <a id="1505" href="Data.Product.html#1389" class="Function Operator">×</a> <a id="1507" href="Text.Lexer.html#594" class="Bound">Tok</a><a id="1510" class="Symbol">)</a>

    <a id="1517" href="Text.Lexer.html#1517" class="Function">init</a> <a id="1522" class="Symbol">:</a> <a id="1524" href="Text.Lexer.html#1457" class="Function">Keywords</a>
    <a id="1537" href="Text.Lexer.html#1517" class="Function">init</a> <a id="1542" class="Symbol">=</a> <a id="1544" href="Data.List.Base.html#1186" class="Function">List.map</a> <a id="1553" class="Symbol">(</a><a id="1554" href="Data.Product.html#2369" class="Function">Prod.map₁</a> <a id="1564" href="Agda.Builtin.String.html#262" class="Primitive">String.toList</a><a id="1577" class="Symbol">)</a> <a id="1579" href="Function.html#1927" class="Function Operator">$</a> <a id="1581" href="Data.List.NonEmpty.html#1701" class="Function">List⁺.toList</a> <a id="1594" href="Function.html#1927" class="Function Operator">$</a> <a id="1596" href="Text.Lexer.html#720" class="Bound">keywords</a>

    <a id="1610" href="Text.Lexer.html#1610" class="Function">read</a> <a id="1615" class="Symbol">:</a> <a id="1617" href="Agda.Builtin.Char.html#200" class="Postulate">Char</a> <a id="1622" class="Symbol">→</a> <a id="1624" href="Text.Lexer.html#1457" class="Function">Keywords</a> <a id="1633" class="Symbol">→</a> <a id="1635" href="Text.Lexer.html#1457" class="Function">Keywords</a>
    <a id="1648" href="Text.Lexer.html#1610" class="Function">read</a> <a id="1653" href="Text.Lexer.html#1653" class="Bound">t</a> <a id="1655" class="Symbol">=</a> <a id="1657" href="Data.List.Base.html#1305" class="Function">List.mapMaybe</a> <a id="1671" href="Function.html#1927" class="Function Operator">$</a> <a id="1673" class="Symbol">λ</a> <a id="1675" class="Keyword">where</a>
      <a id="1687" class="Symbol">(</a><a id="1688" href="Text.Lexer.html#1688" class="Bound">c</a> <a id="1690" href="Agda.Builtin.List.html#173" class="InductiveConstructor Operator">∷</a> <a id="1692" href="Text.Lexer.html#1692" class="Bound">cs</a> <a id="1695" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="1697" href="Text.Lexer.html#1697" class="Bound">tok</a><a id="1700" class="Symbol">)</a> <a id="1702" class="Symbol">→</a> <a id="1704" href="Data.Bool.Base.html#835" class="Function Operator">if</a> <a id="1707" href="Text.Lexer.html#1688" class="Bound">c</a> <a id="1709" href="Data.Char.Properties.html#1531" class="Function Operator">==</a> <a id="1712" href="Text.Lexer.html#1653" class="Bound">t</a> <a id="1714" href="Data.Bool.Base.html#835" class="Function Operator">then</a> <a id="1719" href="Data.Maybe.Base.html#748" class="InductiveConstructor">just</a> <a id="1724" class="Symbol">(</a><a id="1725" href="Text.Lexer.html#1692" class="Bound">cs</a> <a id="1728" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="1730" href="Text.Lexer.html#1697" class="Bound">tok</a><a id="1733" class="Symbol">)</a> <a id="1735" href="Data.Bool.Base.html#835" class="Function Operator">else</a> <a id="1740" href="Data.Maybe.Base.html#778" class="InductiveConstructor">nothing</a>
      <a id="1754" class="CatchallClause Symbol">_</a> <a id="1756" class="Symbol">→</a> <a id="1758" href="Data.Maybe.Base.html#778" class="InductiveConstructor">nothing</a>

    <a id="1771" href="Text.Lexer.html#1771" class="Function">value</a> <a id="1777" class="Symbol">:</a> <a id="1779" href="Text.Lexer.html#1457" class="Function">Keywords</a> <a id="1788" class="Symbol">→</a> <a id="1790" href="Data.Maybe.Base.html#710" class="Datatype">Maybe</a> <a id="1796" href="Text.Lexer.html#594" class="Bound">Tok</a>
    <a id="1804" href="Text.Lexer.html#1771" class="Function">value</a> <a id="1810" href="Text.Lexer.html#1810" class="Bound">ks</a> <a id="1813" class="Symbol">=</a> <a id="1815" href="Data.List.Base.html#6992" class="Function">List.head</a> <a id="1825" href="Function.html#1927" class="Function Operator">$</a> <a id="1827" href="Function.html#1572" class="Function">flip</a> <a id="1832" href="Data.List.Base.html#1305" class="Function">List.mapMaybe</a> <a id="1846" href="Text.Lexer.html#1810" class="Bound">ks</a> <a id="1849" href="Function.html#1927" class="Function Operator">$</a> <a id="1851" class="Symbol">λ</a> <a id="1853" class="Keyword">where</a>
      <a id="1865" class="Symbol">(</a><a id="1866" href="Agda.Builtin.List.html#158" class="InductiveConstructor">[]</a> <a id="1869" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="1871" href="Text.Lexer.html#1871" class="Bound">k</a><a id="1872" class="Symbol">)</a> <a id="1874" class="Symbol">→</a> <a id="1876" href="Data.Maybe.Base.html#748" class="InductiveConstructor">just</a> <a id="1881" href="Text.Lexer.html#1871" class="Bound">k</a>
      <a id="1889" class="CatchallClause Symbol">_</a> <a id="1891" class="Symbol">→</a> <a id="1893" href="Data.Maybe.Base.html#778" class="InductiveConstructor">nothing</a>

    <a id="1906" class="Comment">-- Kickstart the tokeniser with an empty accumulator and the initial trie.</a>
    <a id="1985" href="Text.Lexer.html#1985" class="Function">start</a> <a id="1991" class="Symbol">:</a> <a id="1993" href="Text.Parser.Position.html#310" class="Record">Position</a> <a id="2002" class="Symbol">→</a> <a id="2004" href="Agda.Builtin.List.html#121" class="Datatype">List</a> <a id="2009" href="Agda.Builtin.Char.html#200" class="Postulate">Char</a> <a id="2014" class="Symbol">→</a> <a id="2016" href="Text.Lexer.html#1153" class="Function">Result</a>
    <a id="2027" href="Text.Lexer.html#1985" class="Function">start</a> <a id="2033" href="Text.Lexer.html#2033" class="Bound">p</a> <a id="2035" class="Symbol">=</a> <a id="2037" href="Text.Lexer.html#2084" class="Function">loop</a> <a id="2042" class="Symbol">(</a><a id="2043" href="Text.Lexer.html#2033" class="Bound">p</a> <a id="2045" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="2047" href="Agda.Builtin.List.html#158" class="InductiveConstructor">[]</a><a id="2049" class="Symbol">)</a> <a id="2051" href="Text.Lexer.html#1517" class="Function">init</a> <a id="2056" href="Text.Lexer.html#2033" class="Bound">p</a>

    <a id="2063" class="Comment">-- The main loop</a>
    <a id="2084" href="Text.Lexer.html#2084" class="Function">loop</a> <a id="2089" class="Symbol">:</a>
      <a id="2097" class="Symbol">(</a><a id="2098" href="Text.Lexer.html#2098" class="Bound">acc</a>  <a id="2103" class="Symbol">:</a> <a id="2105" href="Text.Parser.Position.html#310" class="Record">Position</a> <a id="2114" href="Data.Product.html#1389" class="Function Operator">×</a> <a id="2116" href="Agda.Builtin.List.html#121" class="Datatype">List</a> <a id="2121" href="Agda.Builtin.Char.html#200" class="Postulate">Char</a><a id="2125" class="Symbol">)</a> <a id="2127" class="Symbol">→</a> <a id="2129" class="Comment">-- start position &amp; chars read so far in this token</a>
      <a id="2187" class="Symbol">(</a><a id="2188" href="Text.Lexer.html#2188" class="Bound">toks</a> <a id="2193" class="Symbol">:</a> <a id="2195" href="Text.Lexer.html#1457" class="Function">Keywords</a><a id="2203" class="Symbol">)</a>             <a id="2217" class="Symbol">→</a> <a id="2219" class="Comment">-- keyword candidates left at this point</a>
      <a id="2266" class="Symbol">(</a><a id="2267" href="Text.Lexer.html#2267" class="Bound">pos</a> <a id="2271" class="Symbol">:</a> <a id="2273" href="Text.Parser.Position.html#310" class="Record">Position</a><a id="2281" class="Symbol">)</a>              <a id="2296" class="Symbol">→</a> <a id="2298" class="Comment">-- current position in the input string</a>
      <a id="2344" class="Symbol">(</a><a id="2345" href="Text.Lexer.html#2345" class="Bound">input</a> <a id="2351" class="Symbol">:</a> <a id="2353" href="Agda.Builtin.List.html#121" class="Datatype">List</a> <a id="2358" href="Agda.Builtin.Char.html#200" class="Postulate">Char</a><a id="2362" class="Symbol">)</a>           <a id="2374" class="Symbol">→</a> <a id="2376" class="Comment">-- list of chars to tokenize</a>
      <a id="2411" href="Text.Lexer.html#1153" class="Function">Result</a>
    <a id="2422" class="Comment">-- Empty input: finish up, check whether we have a non-empty accumulator</a>
    <a id="2499" href="Text.Lexer.html#2084" class="Function">loop</a> <a id="2504" href="Text.Lexer.html#2504" class="Bound">acc</a> <a id="2508" href="Text.Lexer.html#2508" class="Bound">toks</a> <a id="2513" href="Text.Lexer.html#2513" class="Bound">pos</a> <a id="2517" href="Agda.Builtin.List.html#158" class="InductiveConstructor">[]</a>         <a id="2528" class="Symbol">=</a> <a id="2530" href="Text.Lexer.html#3481" class="Function">push</a> <a id="2535" href="Text.Lexer.html#2504" class="Bound">acc</a> <a id="2539" href="Agda.Builtin.List.html#158" class="InductiveConstructor">[]</a>
    <a id="2546" class="Comment">-- At least one character</a>
    <a id="2576" href="Text.Lexer.html#2084" class="Function">loop</a> <a id="2581" href="Text.Lexer.html#2581" class="Bound">acc</a> <a id="2585" href="Text.Lexer.html#2585" class="Bound">toks</a> <a id="2590" href="Text.Lexer.html#2590" class="Bound">pos</a> <a id="2594" class="Symbol">(</a><a id="2595" href="Text.Lexer.html#2595" class="Bound">c</a> <a id="2597" href="Agda.Builtin.List.html#173" class="InductiveConstructor Operator">∷</a> <a id="2599" href="Text.Lexer.html#2599" class="Bound">cs</a><a id="2601" class="Symbol">)</a>   <a id="2605" class="Symbol">=</a> <a id="2607" href="Function.html#3533" class="Function Operator">case</a> <a id="2612" href="Text.Lexer.html#946" class="Bound">breaking</a> <a id="2621" href="Text.Lexer.html#2595" class="Bound">c</a> <a id="2623" href="Function.html#3533" class="Function Operator">of</a> <a id="2626" class="Symbol">λ</a> <a id="2628" class="Keyword">where</a>
      <a id="2640" class="Comment">-- if we are supposed to break on this character, we do</a>
      <a id="2702" class="Symbol">(</a><a id="2703" href="Agda.Builtin.Bool.html#160" class="InductiveConstructor">true</a> <a id="2708" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="2710" href="Text.Lexer.html#2710" class="Bound">m</a><a id="2711" class="Symbol">)</a>  <a id="2714" class="Symbol">→</a> <a id="2716" href="Text.Lexer.html#3481" class="Function">push</a> <a id="2721" href="Text.Lexer.html#2581" class="Bound">acc</a> <a id="2725" href="Function.html#1927" class="Function Operator">$</a> <a id="2727" href="Text.Lexer.html#3782" class="Function">break</a> <a id="2733" href="Text.Lexer.html#2590" class="Bound">pos</a> <a id="2737" href="Text.Lexer.html#2710" class="Bound">m</a> <a id="2739" href="Function.html#1927" class="Function Operator">$</a> <a id="2741" href="Text.Lexer.html#1985" class="Function">start</a> <a id="2747" class="Symbol">(</a><a id="2748" href="Text.Parser.Position.html#461" class="Function">Pos.update</a> <a id="2759" href="Text.Lexer.html#2595" class="Bound">c</a> <a id="2761" href="Text.Lexer.html#2590" class="Bound">pos</a><a id="2764" class="Symbol">)</a> <a id="2766" href="Text.Lexer.html#2599" class="Bound">cs</a>
      <a id="2775" class="Comment">-- otherwise we see whether reading it leads to a recognized keyword</a>
      <a id="2850" class="Symbol">(</a><a id="2851" href="Agda.Builtin.Bool.html#154" class="InductiveConstructor">false</a> <a id="2857" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="2859" class="Symbol">_)</a> <a id="2862" class="Symbol">→</a> <a id="2864" class="Keyword">let</a> <a id="2868" href="Text.Lexer.html#2868" class="Bound">toks&#39;</a> <a id="2874" class="Symbol">=</a> <a id="2876" href="Text.Lexer.html#1610" class="Function">read</a> <a id="2881" href="Text.Lexer.html#2595" class="Bound">c</a> <a id="2883" href="Text.Lexer.html#2585" class="Bound">toks</a> <a id="2888" class="Keyword">in</a> <a id="2891" href="Function.html#3533" class="Function Operator">case</a> <a id="2896" href="Text.Lexer.html#1771" class="Function">value</a> <a id="2902" href="Text.Lexer.html#2868" class="Bound">toks&#39;</a> <a id="2908" href="Function.html#3533" class="Function Operator">of</a> <a id="2911" class="Symbol">λ</a> <a id="2913" class="Keyword">where</a>
        <a id="2927" class="Comment">-- if so we can forget about the current accumulator and restart</a>
        <a id="3000" class="Comment">-- the tokenizer on the rest of the input</a>
        <a id="3050" class="Symbol">(</a><a id="3051" href="Data.Maybe.Base.html#748" class="InductiveConstructor">just</a> <a id="3056" href="Text.Lexer.html#3056" class="Bound">k</a><a id="3057" class="Symbol">)</a> <a id="3059" class="Symbol">→</a> <a id="3061" class="Symbol">(</a><a id="3062" href="Agda.Builtin.Sigma.html#225" class="Field">proj₁</a> <a id="3068" href="Text.Lexer.html#2581" class="Bound">acc</a> <a id="3072" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="3074" href="Text.Lexer.html#3056" class="Bound">k</a><a id="3075" class="Symbol">)</a> <a id="3077" href="Agda.Builtin.List.html#173" class="InductiveConstructor Operator">∷</a> <a id="3079" href="Text.Lexer.html#1985" class="Function">start</a> <a id="3085" class="Symbol">(</a><a id="3086" href="Text.Parser.Position.html#461" class="Function">Pos.update</a> <a id="3097" href="Text.Lexer.html#2595" class="Bound">c</a> <a id="3099" href="Text.Lexer.html#2590" class="Bound">pos</a><a id="3102" class="Symbol">)</a> <a id="3104" href="Text.Lexer.html#2599" class="Bound">cs</a>
        <a id="3115" class="Comment">-- otherwise we record the character we read in the accumulator,</a>
        <a id="3188" class="Comment">-- and keep going with the derivative of the map of keyword candidates</a>
        <a id="3267" class="Comment">-- and the rest of the input</a>
        <a id="3304" href="Data.Maybe.Base.html#778" class="InductiveConstructor">nothing</a>  <a id="3313" class="Symbol">→</a> <a id="3315" href="Text.Lexer.html#2084" class="Function">loop</a> <a id="3320" class="Symbol">(</a><a id="3321" href="Data.Product.html#2474" class="Function">Prod.map₂</a> <a id="3331" class="Symbol">(</a><a id="3332" href="Text.Lexer.html#2595" class="Bound">c</a> <a id="3334" href="Agda.Builtin.List.html#173" class="InductiveConstructor Operator">∷_</a><a id="3336" class="Symbol">)</a> <a id="3338" href="Text.Lexer.html#2581" class="Bound">acc</a><a id="3341" class="Symbol">)</a> <a id="3343" href="Text.Lexer.html#2868" class="Bound">toks&#39;</a> <a id="3349" class="Symbol">(</a><a id="3350" href="Text.Parser.Position.html#461" class="Function">Pos.update</a> <a id="3361" href="Text.Lexer.html#2595" class="Bound">c</a> <a id="3363" href="Text.Lexer.html#2590" class="Bound">pos</a><a id="3366" class="Symbol">)</a> <a id="3368" href="Text.Lexer.html#2599" class="Bound">cs</a>

    <a id="3376" class="Comment">-- Grab the accumulator and, unless it is empty, push it on top of the</a>
    <a id="3451" class="Comment">-- decoded list of tokens</a>
    <a id="3481" href="Text.Lexer.html#3481" class="Function">push</a> <a id="3486" class="Symbol">:</a> <a id="3488" class="Symbol">(</a><a id="3489" href="Text.Parser.Position.html#310" class="Record">Position</a> <a id="3498" href="Data.Product.html#1389" class="Function Operator">×</a> <a id="3500" href="Agda.Builtin.List.html#121" class="Datatype">List</a> <a id="3505" href="Agda.Builtin.Char.html#200" class="Postulate">Char</a><a id="3509" class="Symbol">)</a> <a id="3511" class="Symbol">→</a> <a id="3513" href="Text.Lexer.html#1153" class="Function">Result</a> <a id="3520" class="Symbol">→</a> <a id="3522" href="Text.Lexer.html#1153" class="Function">Result</a>
    <a id="3533" href="Text.Lexer.html#3481" class="Function">push</a> <a id="3538" class="Symbol">(</a><a id="3539" href="Text.Lexer.html#3539" class="Bound">pos</a> <a id="3543" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="3545" href="Agda.Builtin.List.html#158" class="InductiveConstructor">[]</a><a id="3547" class="Symbol">)</a> <a id="3549" href="Text.Lexer.html#3549" class="Bound">ts</a> <a id="3552" class="Symbol">=</a> <a id="3554" href="Text.Lexer.html#3549" class="Bound">ts</a>
    <a id="3561" href="Text.Lexer.html#3481" class="CatchallClause Function">push</a><a id="3565" class="CatchallClause"> </a><a id="3566" class="CatchallClause Symbol">(</a><a id="3567" href="Text.Lexer.html#3567" class="CatchallClause Bound">pos</a><a id="3570" class="CatchallClause"> </a><a id="3571" href="Agda.Builtin.Sigma.html#209" class="CatchallClause InductiveConstructor Operator">,</a><a id="3572" class="CatchallClause"> </a><a id="3573" href="Text.Lexer.html#3573" class="CatchallClause Bound">cs</a><a id="3575" class="CatchallClause Symbol">)</a><a id="3576" class="CatchallClause"> </a><a id="3577" href="Text.Lexer.html#3577" class="CatchallClause Bound">ts</a> <a id="3580" class="Symbol">=</a> <a id="3582" class="Symbol">(</a><a id="3583" href="Text.Lexer.html#3567" class="Bound">pos</a> <a id="3587" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="3589" href="Text.Lexer.html#1117" class="Bound">default</a> <a id="3597" class="Symbol">(</a><a id="3598" href="Agda.Builtin.String.html#304" class="Primitive">String.fromList</a> <a id="3614" class="Symbol">(</a><a id="3615" href="Data.List.Base.html#9615" class="Function">List.reverse</a> <a id="3628" href="Text.Lexer.html#3573" class="Bound">cs</a><a id="3630" class="Symbol">)))</a> <a id="3634" href="Agda.Builtin.List.html#173" class="InductiveConstructor Operator">∷</a> <a id="3636" href="Text.Lexer.html#3577" class="Bound">ts</a>

    <a id="3644" class="Comment">-- The action corresponding to a breaking character: we only push something</a>
    <a id="3724" class="Comment">-- if the breaking character is associated to a token</a>
    <a id="3782" href="Text.Lexer.html#3782" class="Function">break</a> <a id="3788" class="Symbol">:</a> <a id="3790" href="Text.Parser.Position.html#310" class="Record">Position</a> <a id="3799" class="Symbol">→</a> <a id="3801" href="Data.Maybe.Base.html#710" class="Datatype">Maybe</a> <a id="3807" href="Text.Lexer.html#594" class="Bound">Tok</a> <a id="3811" class="Symbol">→</a> <a id="3813" href="Text.Lexer.html#1153" class="Function">Result</a> <a id="3820" class="Symbol">→</a> <a id="3822" href="Text.Lexer.html#1153" class="Function">Result</a>
    <a id="3833" href="Text.Lexer.html#3782" class="Function">break</a> <a id="3839" href="Text.Lexer.html#3839" class="Bound">pos</a> <a id="3843" class="Symbol">(</a><a id="3844" href="Data.Maybe.Base.html#748" class="InductiveConstructor">just</a> <a id="3849" href="Text.Lexer.html#3849" class="Bound">tok</a><a id="3852" class="Symbol">)</a> <a id="3854" href="Text.Lexer.html#3854" class="Bound">rs</a> <a id="3857" class="Symbol">=</a> <a id="3859" class="Symbol">(</a><a id="3860" href="Text.Lexer.html#3839" class="Bound">pos</a> <a id="3864" href="Agda.Builtin.Sigma.html#209" class="InductiveConstructor Operator">,</a> <a id="3866" href="Text.Lexer.html#3849" class="Bound">tok</a><a id="3869" class="Symbol">)</a> <a id="3871" href="Agda.Builtin.List.html#173" class="InductiveConstructor Operator">∷</a> <a id="3873" href="Text.Lexer.html#3854" class="Bound">rs</a>
    <a id="3880" href="Text.Lexer.html#3782" class="Function">break</a> <a id="3886" href="Text.Lexer.html#3886" class="Bound">pos</a> <a id="3890" href="Data.Maybe.Base.html#778" class="InductiveConstructor">nothing</a>    <a id="3901" href="Text.Lexer.html#3901" class="Bound">rs</a> <a id="3904" class="Symbol">=</a> <a id="3906" href="Text.Lexer.html#3901" class="Bound">rs</a>
</pre></body></html>