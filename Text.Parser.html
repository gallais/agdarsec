<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Text.Parser</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Keyword">open</a> <a id="6" class="Keyword">import</a> <a id="13" href="Level.html" class="Module">Level</a> <a id="19" class="Keyword">using</a> <a id="25" class="Symbol">(</a><a id="26" href="Agda.Primitive.html#423" class="Postulate">Level</a><a id="31" class="Symbol">)</a>

<a id="34" class="Keyword">module</a> <a id="41" href="Text.Parser.html" class="Module">Text.Parser</a> <a id="53" class="Symbol">(</a><a id="54" href="Text.Parser.html#54" class="Bound">l</a> <a id="56" class="Symbol">:</a> <a id="58" href="Agda.Primitive.html#423" class="Postulate">Level</a><a id="63" class="Symbol">)</a> <a id="65" class="Keyword">where</a>

<a id="72" class="Keyword">open</a> <a id="77" class="Keyword">import</a> <a id="84" href="Function.Identity.Categorical.html" class="Module">Function.Identity.Categorical</a> <a id="114" class="Keyword">using</a> <a id="120" class="Symbol">(</a><a id="121" href="Function.Identity.Categorical.html#451" class="Function">Identity</a><a id="129" class="Symbol">)</a>
<a id="131" class="Keyword">open</a> <a id="136" class="Keyword">import</a> <a id="143" href="Category.Monad.html" class="Module">Category.Monad</a>
<a id="158" class="Keyword">open</a> <a id="163" class="Keyword">import</a> <a id="170" href="Data.Char.Base.html" class="Module">Data.Char.Base</a> <a id="185" class="Keyword">using</a> <a id="191" class="Symbol">(</a><a id="192" href="Agda.Builtin.Char.html#227" class="Postulate">Char</a><a id="196" class="Symbol">)</a>
<a id="198" class="Keyword">open</a> <a id="203" class="Keyword">import</a> <a id="210" href="Data.Product.html" class="Module">Data.Product</a> <a id="223" class="Keyword">using</a> <a id="229" class="Symbol">(</a><a id="230" href="Data.Product.html#666" class="Field">proj₁</a><a id="235" class="Symbol">)</a>
<a id="237" class="Keyword">open</a> <a id="242" class="Keyword">import</a> <a id="249" href="Level.Bounded.html" class="Module">Level.Bounded</a> <a id="263" class="Symbol">as</a> <a id="266" class="Module">Level≤</a> <a id="273" class="Keyword">using</a> <a id="279" class="Symbol">(</a><a id="280" href="Level.Bounded.html#867" class="Record">Set≤</a><a id="284" class="Symbol">;</a> <a id="286" href="Level.Bounded.html#931" class="Field">theSet</a><a id="292" class="Symbol">;</a> <a id="294" href="Level.Bounded.html#1072" class="Function Operator">[_]</a><a id="297" class="Symbol">;</a> <a id="299" href="Level.Bounded.html#3274" class="Function">lift</a><a id="303" class="Symbol">;</a> <a id="305" href="Level.Bounded.html#3495" class="Function">lower</a><a id="310" class="Symbol">)</a>
<a id="312" class="Keyword">open</a> <a id="317" class="Keyword">import</a> <a id="324" href="Relation.Unary.html" class="Module">Relation.Unary</a>

<a id="340" class="Keyword">open</a> <a id="345" class="Keyword">import</a> <a id="352" href="Text.Parser.Types.Core.html" class="Module">Text.Parser.Types.Core</a>
<a id="375" class="Keyword">open</a> <a id="380" class="Keyword">import</a> <a id="387" href="Text.Parser.Monad.html" class="Module">Text.Parser.Monad</a>
<a id="405" class="Keyword">open</a> <a id="410" class="Keyword">import</a> <a id="417" href="Text.Parser.Position.html" class="Module">Text.Parser.Position</a> <a id="438" class="Symbol">as</a> <a id="441" class="Module">Position</a> <a id="450" class="Keyword">using</a> <a id="456" class="Symbol">(</a><a id="457" href="Text.Parser.Position.html#380" class="Record">Position</a><a id="465" class="Symbol">;</a> <a id="467" class="Keyword">module</a> <a id="474" href="Text.Parser.Position.html#380" class="Module">Position</a><a id="482" class="Symbol">)</a> <a id="484" class="Keyword">public</a>

<a id="492" class="Keyword">module</a> <a id="CHARS"></a><a id="499" href="Text.Parser.html#499" class="Module">CHARS</a> <a id="505" class="Symbol">=</a> <a id="507" href="Text.Parser.Monad.html#3668" class="Module">Agdarsec</a> <a id="516" href="Text.Parser.html#54" class="Bound">l</a> <a id="518" href="Level.Bounded.html#1072" class="Function Operator">[</a> <a id="520" href="Text.Parser.Position.html#380" class="Record">Position</a> <a id="529" href="Level.Bounded.html#1072" class="Function Operator">]</a> <a id="531" href="Level.Bounded.html#1231" class="Function">Level≤.⊥</a> <a id="540" class="Symbol">(</a><a id="541" class="Keyword">record</a> <a id="548" class="Symbol">{</a> <a id="550" href="Data.Subset.html#173" class="Field">into</a> <a id="555" class="Symbol">=</a> <a id="557" href="Data.Product.html#666" class="Field">proj₁</a> <a id="563" class="Symbol">})</a>

<a id="567" class="Comment">-- Our sized text is represented using vectors of characters</a>

<a id="629" class="Keyword">private</a>
  <a id="ParserM"></a><a id="639" href="Text.Parser.html#639" class="Function">ParserM</a> <a id="647" class="Symbol">:</a> <a id="649" class="PrimitiveType">Set</a> <a id="653" href="Text.Parser.html#54" class="Bound">l</a> <a id="655" class="Symbol">→</a> <a id="657" class="PrimitiveType">Set</a> <a id="661" href="Text.Parser.html#54" class="Bound">l</a>
  <a id="665" href="Text.Parser.html#639" class="Function">ParserM</a> <a id="673" class="Symbol">=</a> <a id="675" href="Text.Parser.Monad.html#991" class="Function">AgdarsecT</a> <a id="685" href="Level.Bounded.html#1072" class="Function Operator">[</a> <a id="687" href="Text.Parser.Position.html#380" class="Record">Position</a> <a id="696" href="Level.Bounded.html#1072" class="Function Operator">]</a> <a id="698" href="Level.Bounded.html#1231" class="Function">Level≤.⊥</a> <a id="707" href="Function.Identity.Categorical.html#451" class="Function">Identity</a>

  <a id="P"></a><a id="719" href="Text.Parser.html#719" class="Function">P</a> <a id="721" class="Symbol">:</a> <a id="723" href="Text.Parser.Types.Core.html#393" class="Record">Parameters</a> <a id="734" href="Text.Parser.html#54" class="Bound">l</a>
  <a id="738" href="Text.Parser.html#719" class="Function">P</a> <a id="740" class="Symbol">=</a> <a id="742" href="Text.Parser.Monad.html#3588" class="Function">CHARS.chars</a>

<a id="755" class="Comment">-- We re-export all of the combinators someone may need, specialised to CHARS</a>

<a id="834" class="Keyword">open</a> <a id="839" href="Level.Bounded.html" class="Module">Level≤</a> <a id="846" class="Keyword">using</a> <a id="852" class="Symbol">(</a><a id="853" href="Level.Bounded.html#1072" class="Function Operator">[_]</a><a id="856" class="Symbol">)</a> <a id="858" class="Keyword">public</a>
<a id="865" class="Keyword">open</a> <a id="870" class="Keyword">import</a> <a id="877" href="Text.Parser.Types.html" class="Module">Text.Parser.Types</a>               <a id="909" href="Text.Parser.html#719" class="Function">P</a> <a id="911" class="Keyword">hiding</a> <a id="918" class="Symbol">(</a>runParser<a id="928" class="Symbol">)</a> <a id="930" class="Keyword">public</a>
<a id="937" class="Keyword">open</a> <a id="942" class="Keyword">import</a> <a id="949" href="Text.Parser.Combinators.html" class="Module">Text.Parser.Combinators</a>         <a id="981" class="Symbol">{</a><a id="982" class="Argument">P</a> <a id="984" class="Symbol">=</a> <a id="986" href="Text.Parser.html#719" class="Function">P</a><a id="987" class="Symbol">}</a> <a id="989" class="Keyword">public</a>
<a id="996" class="Keyword">open</a> <a id="1001" class="Keyword">import</a> <a id="1008" href="Text.Parser.Combinators.Numbers.html" class="Module">Text.Parser.Combinators.Numbers</a> <a id="1040" class="Symbol">{</a><a id="1041" class="Argument">P</a> <a id="1043" class="Symbol">=</a> <a id="1045" href="Text.Parser.html#719" class="Function">P</a><a id="1046" class="Symbol">}</a> <a id="1048" class="Keyword">public</a>
<a id="1055" class="Keyword">open</a> <a id="1060" class="Keyword">import</a> <a id="1067" href="Text.Parser.Combinators.Char.html" class="Module">Text.Parser.Combinators.Char</a>    <a id="1099" class="Symbol">{</a><a id="1100" class="Argument">P</a> <a id="1102" class="Symbol">=</a> <a id="1104" href="Text.Parser.html#719" class="Function">P</a><a id="1105" class="Symbol">}</a> <a id="1107" class="Keyword">public</a>

<a id="1115" class="Comment">-- We export all of the instances that are needed for the combinators to work</a>
<a id="1193" class="Comment">-- out of the box</a>

<a id="1212" class="Keyword">open</a> <a id="1217" class="Keyword">import</a> <a id="1224" href="Data.List.Sized.Interface.html" class="Module">Data.List.Sized.Interface</a> <a id="1250" class="Keyword">using</a> <a id="1256" class="Symbol">(</a><a id="1257" href="Data.List.Sized.Interface.html#514" class="Function">vec</a><a id="1260" class="Symbol">)</a> <a id="1262" class="Keyword">public</a>
<a id="1269" class="Keyword">open</a> <a id="1274" class="Keyword">import</a> <a id="1281" href="Data.Subset.html" class="Module">Data.Subset</a> <a id="1293" class="Keyword">using</a> <a id="1299" class="Symbol">(</a><a id="1300" href="Data.Subset.html#528" class="Function">Subset-refl</a><a id="1311" class="Symbol">)</a> <a id="1313" class="Keyword">public</a>
<a id="1320" class="Keyword">open</a> <a id="1325" class="Keyword">import</a> <a id="1332" href="Relation.Binary.PropositionalEquality.Decidable.html" class="Module">Relation.Binary.PropositionalEquality.Decidable</a> <a id="1380" class="Keyword">using</a> <a id="1386" class="Symbol">(</a><a id="1387" href="Relation.Binary.PropositionalEquality.Decidable.html#269" class="Function">decide-char</a><a id="1398" class="Symbol">)</a> <a id="1400" class="Keyword">public</a>

<a id="1408" class="Keyword">instance</a>

  <a id="P-monad"></a><a id="1420" href="Text.Parser.html#1420" class="Function">P-monad</a> <a id="1428" class="Symbol">:</a> <a id="1430" href="Category.Monad.html#448" class="Function">RawMonad</a> <a id="1439" href="Text.Parser.html#639" class="Function">ParserM</a>
  <a id="1449" href="Text.Parser.html#1420" class="Function">P-monad</a>  <a id="1458" class="Symbol">=</a> <a id="1460" href="Text.Parser.Monad.html#3846" class="Function">CHARS.monad</a>

  <a id="P-monad0"></a><a id="1475" href="Text.Parser.html#1475" class="Function">P-monad0</a> <a id="1484" class="Symbol">:</a> <a id="1486" href="Category.Monad.html#643" class="Function">RawMonadZero</a> <a id="1499" href="Text.Parser.html#639" class="Function">ParserM</a>
  <a id="1509" href="Text.Parser.html#1475" class="Function">P-monad0</a> <a id="1518" class="Symbol">=</a> <a id="1520" href="Text.Parser.Monad.html#1895" class="Function">CHARS.monadZero</a>

  <a id="P-monad+"></a><a id="1539" href="Text.Parser.html#1539" class="Function">P-monad+</a> <a id="1548" class="Symbol">:</a> <a id="1550" href="Category.Monad.html#734" class="Function">RawMonadPlus</a> <a id="1563" href="Text.Parser.html#639" class="Function">ParserM</a>
  <a id="1573" href="Text.Parser.html#1539" class="Function">P-monad+</a> <a id="1582" class="Symbol">=</a> <a id="1584" href="Text.Parser.Monad.html#2281" class="Function">CHARS.monadPlus</a>

<a id="1601" class="Comment">-- Finally we define a function to run a parser and readily obtain a value</a>

<a id="1677" class="Keyword">open</a> <a id="1682" class="Keyword">import</a> <a id="1689" href="Data.Bool.Base.html" class="Module">Data.Bool.Base</a> <a id="1704" class="Keyword">using</a> <a id="1710" class="Symbol">(</a><a id="1711" href="Data.Bool.Base.html#1283" class="Function Operator">if_then_else_</a><a id="1724" class="Symbol">)</a>
<a id="1726" class="Keyword">open</a> <a id="1731" class="Keyword">import</a> <a id="1738" href="Data.List.Base.html" class="Module">Data.List.Base</a> <a id="1753" class="Keyword">using</a> <a id="1759" class="Symbol">(</a><a id="1760" href="Data.List.Base.html#9981" class="InductiveConstructor">[]</a><a id="1762" class="Symbol">)</a>
<a id="1764" class="Keyword">open</a> <a id="1769" class="Keyword">import</a> <a id="1776" href="Data.Sum.Base.html" class="Module">Data.Sum.Base</a> <a id="1790" class="Keyword">using</a> <a id="1796" class="Symbol">(</a><a id="1797" href="Data.Sum.Base.html#734" class="Datatype Operator">_⊎_</a><a id="1800" class="Symbol">;</a> <a id="1802" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a><a id="1806" class="Symbol">;</a> <a id="1808" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a><a id="1812" class="Symbol">)</a>
<a id="1814" class="Keyword">open</a> <a id="1819" class="Keyword">import</a> <a id="1826" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a> <a id="1840" class="Keyword">using</a> <a id="1846" class="Symbol">(</a><a id="1847" href="Data.Nat.Base.html#1064" class="Primitive Operator">_≡ᵇ_</a><a id="1851" class="Symbol">)</a>
<a id="1853" class="Keyword">import</a> <a id="1860" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="1880" class="Symbol">as</a> <a id="1883" class="Module">ℕₚ</a>
<a id="1886" class="Keyword">open</a> <a id="1891" class="Keyword">import</a> <a id="1898" href="Data.Product.html" class="Module">Data.Product</a> <a id="1911" class="Keyword">using</a> <a id="1917" class="Symbol">(</a><a id="1918" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">_,_</a><a id="1921" class="Symbol">)</a>
<a id="1923" class="Keyword">open</a> <a id="1928" class="Keyword">import</a> <a id="1935" href="Data.String.html" class="Module">Data.String</a> <a id="1947" class="Symbol">as</a> <a id="1950" class="Module">String</a> <a id="1957" class="Keyword">using</a> <a id="1963" class="Symbol">(</a><a id="1964" href="Agda.Builtin.String.html#274" class="Postulate">String</a><a id="1970" class="Symbol">)</a>
<a id="1972" class="Keyword">open</a> <a id="1977" class="Keyword">import</a> <a id="1984" href="Function.Base.html" class="Module">Function.Base</a> <a id="1998" class="Keyword">using</a> <a id="2004" class="Symbol">(</a><a id="2005" href="Function.Base.html#4121" class="Function Operator">case_of_</a><a id="2013" class="Symbol">)</a>

<a id="2016" class="Keyword">import</a> <a id="2023" href="Text.Parser.Monad.Result.html" class="Module">Text.Parser.Monad.Result</a> <a id="2048" class="Symbol">as</a> <a id="2051" class="Module">Result</a>
<a id="2058" class="Keyword">open</a> <a id="2063" class="Keyword">import</a> <a id="2070" href="Text.Parser.Position.html" class="Module">Text.Parser.Position</a> <a id="2091" class="Keyword">using</a> <a id="2097" class="Symbol">(</a><a id="2098" href="Text.Parser.Position.html#479" class="Function">start</a><a id="2103" class="Symbol">)</a>

<a id="runParser"></a><a id="2106" href="Text.Parser.html#2106" class="Function">runParser</a> <a id="2116" class="Symbol">:</a> <a id="2118" class="Symbol">{</a><a id="2119" href="Text.Parser.html#2119" class="Bound">A</a> <a id="2121" class="Symbol">:</a> <a id="2123" href="Level.Bounded.html#867" class="Record">Set≤</a> <a id="2128" href="Text.Parser.html#54" class="Bound">l</a><a id="2129" class="Symbol">}</a> <a id="2131" class="Symbol">→</a> <a id="2133" href="Relation.Unary.html#3359" class="Function">∀[</a> <a id="2136" href="Text.Parser.Types.html#564" class="Record">Parser</a> <a id="2143" href="Text.Parser.html#2119" class="Bound">A</a> <a id="2145" href="Relation.Unary.html#3359" class="Function">]</a> <a id="2147" class="Symbol">→</a> <a id="2149" href="Agda.Builtin.String.html#274" class="Postulate">String</a> <a id="2156" class="Symbol">→</a> <a id="2158" href="Text.Parser.Position.html#380" class="Record">Position</a> <a id="2167" href="Data.Sum.Base.html#734" class="Datatype Operator">⊎</a> <a id="2169" href="Level.Bounded.html#931" class="Field">theSet</a> <a id="2176" href="Text.Parser.html#2119" class="Bound">A</a>
<a id="2178" href="Text.Parser.html#2106" class="Function">runParser</a> <a id="2188" href="Text.Parser.html#2188" class="Bound">p</a> <a id="2190" href="Text.Parser.html#2190" class="Bound">str</a> <a id="2194" class="Symbol">=</a>
  <a id="2198" class="Keyword">let</a> <a id="2202" href="Text.Parser.html#2202" class="Bound">init</a>  <a id="2208" class="Symbol">=</a> <a id="2210" href="Level.Bounded.html#3274" class="Function">lift</a> <a id="2215" class="Symbol">(</a><a id="2216" href="Text.Parser.Position.html#479" class="Function">start</a> <a id="2222" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2224" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="2226" class="Symbol">)</a>
      <a id="2234" href="Text.Parser.html#2234" class="Bound">input</a> <a id="2240" class="Symbol">=</a> <a id="2242" href="Level.Bounded.html#3274" class="Function">lift</a> <a id="2247" class="Symbol">(</a><a id="2248" href="Data.String.html#699" class="Function">String.toVec</a> <a id="2261" href="Text.Parser.html#2190" class="Bound">str</a><a id="2264" class="Symbol">)</a>
  <a id="2268" class="Keyword">in</a> <a id="2271" href="Function.Base.html#4121" class="Function Operator">case</a> <a id="2276" href="Text.Parser.Monad.Result.html#736" class="Function">Result.toSum</a> <a id="2289" class="Symbol">(</a><a id="2290" href="Text.Parser.Types.html#657" class="Field">Parser.runParser</a> <a id="2307" href="Text.Parser.html#2188" class="Bound">p</a> <a id="2309" class="Symbol">(</a><a id="2310" href="Data.Nat.Properties.html#6261" class="Function">ℕₚ.n≤1+n</a> <a id="2319" class="Symbol">_)</a> <a id="2322" href="Text.Parser.html#2234" class="Bound">input</a> <a id="2328" href="Text.Parser.html#2202" class="Bound">init</a><a id="2332" class="Symbol">)</a> <a id="2334" href="Function.Base.html#4121" class="Function Operator">of</a> <a id="2337" class="Symbol">λ</a> <a id="2339" class="Keyword">where</a>
        <a id="2353" class="Symbol">(</a><a id="2354" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a> <a id="2359" class="Symbol">(</a><a id="2360" href="Text.Parser.html#2360" class="Bound">res</a> <a id="2364" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2366" href="Text.Parser.html#2366" class="Bound">p</a><a id="2367" class="Symbol">))</a> <a id="2370" class="Symbol">→</a> <a id="2372" class="Keyword">let</a> <a id="2376" class="Keyword">open</a> <a id="2381" href="Text.Parser.Types.Core.html#942" class="Module">Success</a> <a id="2389" class="Keyword">in</a>
                           <a id="2419" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="2422" href="Text.Parser.Types.Core.html#1065" class="Field">size</a> <a id="2427" href="Text.Parser.html#2360" class="Bound">res</a> <a id="2431" href="Data.Nat.Base.html#1064" class="Primitive Operator">≡ᵇ</a> <a id="2434" class="Number">0</a>
                           <a id="2463" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="2468" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a> <a id="2473" class="Symbol">(</a><a id="2474" href="Level.Bounded.html#3495" class="Function">lower</a> <a id="2480" class="Symbol">(</a><a id="2481" href="Text.Parser.Types.Core.html#1041" class="Field">value</a> <a id="2487" href="Text.Parser.html#2360" class="Bound">res</a><a id="2490" class="Symbol">))</a>
                           <a id="2520" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="2525" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="2530" class="Symbol">(</a><a id="2531" href="Data.Product.html#666" class="Field">proj₁</a> <a id="2537" class="Symbol">(</a><a id="2538" href="Level.Bounded.html#3495" class="Function">lower</a> <a id="2544" href="Text.Parser.html#2366" class="Bound">p</a><a id="2545" class="Symbol">))</a>
        <a id="2556" class="Symbol">(</a><a id="2557" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="2562" href="Text.Parser.html#2562" class="Bound">p</a><a id="2563" class="Symbol">)</a> <a id="2565" class="Symbol">→</a> <a id="2567" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="2572" class="Symbol">(</a><a id="2573" href="Level.Bounded.html#3495" class="Function">lower</a> <a id="2579" href="Text.Parser.html#2562" class="Bound">p</a><a id="2580" class="Symbol">)</a>
</pre></body></html>